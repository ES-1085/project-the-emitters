---
title: "Presentation title"
subtitle: "Presentation subtitle (if any)"
author: "Team name <br> Names of team members"
institute: "Bates College"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(gganimate)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(rmapshaper)
library(transformr)
library("rnaturalearth")
library("rnaturalearthdata")
library(gifski)
library(png) 
library(scales)
library(leaflet)
```

```{r read in dataset}
owid_co2_data<- read_csv("../data/owid-co2-data.csv")
```

```{r creat primary dataset we will be using}
Our_co2_dataset <- owid_co2_data %>% 
  select("country", "year", "population", "co2", "co2_per_capita", "iso_code", "gdp") %>% 
  filter(country != "Antarctica")
```

```{r import world map data}
world <- ne_countries(scale = "medium", returnclass = "sf")
class(world)

## [1] "sf"  
## [1] "data.frame"
```

```{r reconfigure heading titles and fill in missing data}
names(world)[10] <- "iso_code"
names(world)[19] <- "country"


all_countries <- Our_co2_dataset %>%
  expand(iso_code, year)


CO2_complete <- left_join(all_countries, Our_co2_dataset, by = c("iso_code", "year"))

```

```{r create a responsibility_value column}
CO2_complete <- CO2_complete %>%
  mutate(gdp_per_capita = gdp / population) %>% 
  mutate(responsibility_value = gdp_per_capita * co2_per_capita)
```

```{r create a year range column}
Our_co2_dataset <- Our_co2_dataset %>% 
  mutate(years = case_when(year <= 1849 ~ "1750 - 1850",
                           year %in% 1850:1899 ~ "1850 - 1899",
                           year %in% 1900:1949 ~ "1900 - 1949",
                           year %in% 1950:1974 ~ "1950 - 1974",
                           year %in% 1975:1999 ~ "1975 - 1999",
                           year %in% 2000:2009 ~ "2000 - 2009",
                           year %in% 2010:2017 ~ "2010 - 2017",
                           year >= 2018 ~ "2018"))
```


```{r merge our dataset with spacial data}
merged_data <- full_join(world, CO2_complete, by = c("iso_code"))
```

```{r create a sub dataset for testing}
sub_data <- merged_data %>% 
  filter(year > 2017)
```

```{r define year range for animation}
responsibility_data <- merged_data %>% 
  filter(year > 1849) %>% 
  filter(year < 2019)
```

```{r, fig.alt = "This plot show the correlation between CO2 emmisions and GDP. We see a general trend of CO2 and gdp increasing over time." correlation between gdp and CO2 emissions coloured by time frame.}
Our_co2_dataset %>%
  filter(country != 'World') %>% 
ggplot(aes(y = co2, x = gdp, color = years)) +
    geom_point() +
  labs(title = "Correlation between GDP and yearly carbon emissions", x = "GDP", y = "CO2")
```

```{r, fig.alt="Figure showing a map of the world coloured by 2018 reponcibility value. Canada, the USA, Saudia Arabia, Australia, and Norway seem to have the highest responcibility value." create map coloured by responsibility value}
merged_data %>% 
  filter(year == 2018) %>% 
ggplot(aes(fill = responsibility_value)) +
    geom_sf() +
  scale_fill_gradientn(colours = c("white", "red", "black"), 
                         values = rescale(c(0, 1, 3)),
                         guide = "colorbar", limits=c(0, 1100000)) +
  theme_void()
```

```{r, fig.alt="Figure showing a map of the world coloured by 2018 CO2 emissions per capita. Kazakhstan, Saudi Arabia, Mongolia, United States, Canada, and Australia seem to have the highest CO2 emissions per capita."  create map coloured by CO2 per capita}
merged_data %>% 
  filter(year == 2018) %>% 
ggplot(aes(fill = co2_per_capita)) +
    geom_sf() +
  scale_fill_gradientn(colours = c("white", "red", "black"),
                       values = rescale(c(0, 1, 3)),
                       guide = "colorbar", limits=c(0, 20)) +
  theme_void()
```

```{r, fig.alt="Figure showing a map of the world coloured by 2018 CO2 emissions. The USA and China have by far the greatest CO2 emissions."  Create map coloured by CO2}
merged_data %>% 
  filter(year == 2018) %>% 
ggplot(aes(fill = co2)) +
    geom_sf() +
  scale_fill_gradientn(colours = c("white", "red", "black"),
                       values = rescale(c(0, 1, 3)),
                       guide = "colorbar", limits=c(0, 11000)) +
  theme_void()
```

```{r, fig.alt="Figure showing an inteactive map of the world coloured by 2018 reponcibility value. Canada, the USA, Saudia Arabia, Australia, and Norway seem to have the highest responcibility value." create interactive leaflet map coloured by responsibility value}
bins = c(0, 125000, 250000, 375000, 500000, 625000, 750000, 875000, 1000000, 100000000)

pal <- colorBin("Reds", domain = merged_data$responsibility_value, bins = bins)

#labels <- sprintf("<strong>%s</strong><br/>%g responsibility_value", merged_data$name, merged_data$responsibility_value) %>% lapply(htmltools::HTML)
#head(labels, 1)

merged_data %>%
  filter(year == 2018) %>%
leaflet() %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(responsibility_value), # specify fill color for polygons
    stroke = TRUE, # add border to polygons
    weight = 0.5, # set border weight
    opacity = 1, # set border opacity
    color = "black", # set border color
    fillOpacity = 0.7, # set fill opacity
    label = ~responsibility_value
    )
```

```{r, fig.alt="Figure showing an interactive map of the world coloured by 2018 CO2 emissions per capita. Kazakhstan, Saudi Arabia, Mongolia, United States, Canada, and Australia seem to have the highest CO2 emissions per capita." create interactive leaflet map coloured by CO2 per capita}
bins = c(0, 2, 4, 6, 8, 10, 12, 14, 16, 100)

pal <- colorBin("Reds", domain = merged_data$responsibility_value, bins = bins)
#pal <- colorNumeric("Reds", domain = merged_data$responsibility_value)

merged_data %>%
  filter(year == 2018) %>%
leaflet() %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(co2_per_capita), # specify fill color for polygons
    stroke = TRUE, # add border to polygons
    weight = 0.5, # set border weight
    opacity = 1, # set border opacity
    color = "black", # set border color
    fillOpacity = 0.7, # set fill opacity
    label = ~co2_per_capita # add hover-over label for country name
  )
```

```{r, fig.alt="Figure showing a map of the world coloured by 2018 CO2 emissions. The USA and China have by far the greatest CO2 emissions." create interactive leaflet map coloured by CO2}
bins = c(0, 1, 4.5, 20.6, 93, 418.1, 1881.5, 8466.9, 38101)

pal <- colorBin("Reds", domain = merged_data$responsibility_value, bins = bins)
#pal <- colorNumeric("Reds", domain = merged_data$responsibility_value)

merged_data %>%
  filter(year == 2018) %>%
leaflet() %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(co2), # specify fill color for polygons
    stroke = TRUE, # add border to polygons
    weight = 0.5, # set border weight
    opacity = 1, # set border opacity
    color = "black", # set border color
    fillOpacity = 0.7, # set fill opacity
    label = ~co2# add hover-over label for country name
  )
```

```{r create animated map}
my_map <- ggplot() +
  geom_sf(data = merged_data, aes(fill = co2_per_capita, group = year)) +
  scale_fill_gradientn(colours = c("white", "red", "black"), 
                         values = rescale(c(0, 1, 3)),
                         guide = "colorbar", limits=c(0, 25)) +
  theme_void() +
  transition_states(year, transition_length = 2, state_length = 1) +
  ease_aes('linear') +
  labs(title = "Year: {closest_state}")
```

```{r, fig.alt="Displays an animation of countries responcibilty towards climate change as indicate by their CO2 emissions per capita times their GDP per capita. We see that most countries do not have data until around 1950. In addition, we see the value for countries such as Canada, the USA, Saudia Arabia, Australia, and Norway increase dramatically up until 2018, with the USA sustaining a high responcibility value from 1950 onwards." animate map and save animation as an mp4 file}
animate(R_map2, fps=2, renderer = av_renderer())
anim_save(filename = "R_map.mp4")
```



```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here
```

```{r}
style_xaringan(
  title_slide_background_image = "img/confetti.jpg"
)
```


class: center, middle

## A statement of the overall goal / research question

---

class: inverse, center, middle

# Section title

---

# Hello World

- Click the `Knit` button to compile your presentation

- Make sure to commit and push all resulting files to your GitHub repo

---

class: inverse, middle, center

# Using xaringan

---

# xaringan

- The presentation is created using the `xaringan` package

- Use `---` to separate slides and `--` for incremental builds

--

- Like this

---

# Layouts

You can use plain text

- or bullet points

.pull-left[
or text in two columns $^*$
]
.pull-right[
- like
- this
]

.footnote[
[*] And add footnotes
]

---

# Code

```{r boring-regression}
# a boring regression
model <- lm(dist ~ speed, data = cars)
tidy(model)
glance(model)
```

---

# Plots

```{r recode-species, echo = FALSE}
# In this chunk I'm doing a bunch of analysis that I don't want to present 
# in my slides. But I need the resulting data frame for a plot I want to present.
iris_modified <- iris %>%
  mutate(Species = fct_other(Species, keep = "setosa"))
```

```{r plot-iris, echo = FALSE}
# Code hidden with echo = FALSE
# Uses modified iris dataset from previous chunk
# Play around with height and width until you're happy with the look
ggplot(data = iris_modified, mapping = aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() + 
  theme_minimal() # theme options: https://ggplot2.tidyverse.org/reference/ggtheme.html
```

---

## Plot and text

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger
ggplot(penguins, aes(x = bill_length_mm, y = species, color = species)) +
  geom_boxplot() +
  theme_minimal()
```
]

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r iris-table, echo = FALSE}
kable(head(iris), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "60%", fig.align = "center", fig.cap = "Image credit: Photo by Jörg Angeli on Unsplash."}
include_graphics("https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80")
```

Or you can also include a full page image. See next slide.

---

background-image: url(https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80)

---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

# Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
